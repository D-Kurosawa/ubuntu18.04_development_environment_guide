# Rust のイントール

**Rust**(ラスト)はMozillaが支援するオープンソースのシステムプログラミング言語です。

Rustは速度、並行性、安全性を言語仕様として保証するC言語、C++に代わるシステムプログラミングに適したプログラミング言語を目指しています。2015年に1.0版がリリースされるまでにいくつもの破壊的な仕様変更がありましたが、1.0版以降は基本的には後方互換を保って6週間間隔で定期的にリリースされています。

Rustはマルチパラダイムプログラミング言語であり、手続き型プログラミング、オブジェクト指向プログラミング、関数型プログラミングなどの実装手法をサポートしています。コンパイル基盤にMIRとLLVMを用いており、実行時速度性能はC言語と同等程度です。強力な型システムとリソース管理の仕組みにより、メモリ安全性が保証されています。

Rustは2016〜2019年の間Stack Overflow Developer Surveyで「最も愛されているプログラミング言語」で一位を獲得し続けていますが、学習難易度が高い言語とも考えられております。

## 1. インストール

Rustは、`rustup`というRustのバージョンと関連するツールを管理するコマンドラインツールを使用してダウンロードします。以下のコマンドで`rustup`をインストールします。

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

Rustが正常にインストールされているか確かめるには、以下のコマンドを使用してください。

```bash
rustc --version
```

バージョン情報が表示されれば成功です。

## 2. サンプルプログラムのコンパイル＆実行

適当なディレクトリに以下のソースコードを記載します。

```bash
cd
mkdir test_compile
cd test_compile/
touch hello.rs
```

```rust
fn main() {
    println!("Hello, World!");
}
```

ソースを以下のコマンドでコンパイルして実行します。ターミナルに`Hello World!`と表示されれば成功です。

```bash
rustc -o hello_rust hello.rs

./hello_rust
```

## 3. Cargo でのサンプルプログラムのコンパイル＆実行

`Cargo`は、Rustのビルドシステム兼、パッケージマネージャです。ほとんどのRustaceanはこのツールを使用して、 Rustプロジェクトの管理をしています。Cargoは、コードのビルドやコードが依存しているライブラリのダウンロード、 それらのライブラリのビルド(コードが必要とするライブラリを我々は、依存と呼んでいます)などの多くの仕事を扱ってくれるからです。

Cargoは、公式のインストーラを使用していれば勝手にインストールされます。

### 3-1. Cargoでプロジェクトの作成

適当なディレクトリで以下のコマンドを実行します。

```bash
cargo new hello_cargo --bin
```

このコマンドは、`hello_cargo`という新しいバイナリの実行可能ファイルを作成します。`cargo new`に渡した`--bin`引数が、 ライブラリとは対照的に実行可能なアプリケーション(よく単にバイナリと呼ばれる)を作成します。プロジェクトを`hello_cargo`と名付けCargoはそのファイルを同名のディレクトリに作成します。

作成した`hello_cargo`ディレクトリに行き、ファイルを列挙してください。

```bash
cd hello_cargo
ls -al
```

Cargoが2つのファイルと1つのディレクトリを生成し、新しいGitリポジトリも初期化しています。

では、`src/main.rs`を開いて覗いてみてください。

```rust
fn main() {
    println!("Hello, world!");
}
```

Cargoは**Hello, world!プログラム**を生成してくれています。ここまでで、 前のプロジェクトとCargoが生成したプロジェクトの違いは、Cargoがsrcディレクトリにコードを配置し最上位のディレクトリにCargo.toml設定ファイルがあることです。

Cargoは、ソースファイルがsrcディレクトリにあることを期待します。プロジェクトの最上位のディレクトリは、`READMEファイル`、`ライセンス情報`、`設定ファイル`、あるいは、`他のコードに関連しないもの`のためのものです。 Cargoを使用するとプロジェクトを体系化する手助けをしてくれます。

### 3-2. Cargoプロジェクトのビルド＆実行

`hello_cargo`ディレクトリから、 以下のコマンドでプロジェクトをビルドします。

```bash
cargo build
```

このコマンドは、カレントディレクトリではなく、`target/debug/hello_cargo`に実行可能ファイルを作成します。

`cargo run`を使用すると、コードをコンパイルしそれから吐かれた実行可能ファイルを全部1コマンドで実行することもできます。

```bash
cargo run
```

Cargoは`cargo check`というコマンドも提供しています。このコマンドは、迅速にコードを確認し、 コンパイルできることを確かめますが、実行可能ファイルは生成しません。

### 3-3. リリースビルド

プロジェクトを最終的にリリースする準備ができたら、以下のコマンドで最適化を行なってコンパイルすることができます。

```bash
cargo build --release
```

このコマンドは、`target/debug`ではなく`target/release`に実行可能ファイルを作成します。

最適化は、Rustコードの実行を速くしてくれますが、オンにするとプログラムをコンパイルする時間が延びます。このため、2つの異なるプロファイルがあるのです(頻繁に再ビルドをかけたい開発用と、繰り返し再ビルドすることはなくできるだけ高速に動いてユーザにあげる最終的なプログラムをビルドする用)。

コードの実行時間をベンチマークするなら、`cargo build --release`を確実に実行し`target/release`の実行可能ファイルでベンチマークしてください。

### 3-4. Cargoまとめ

Cargoをまとめると以下のようになります。

- `cargo build`か`cargo check`でプロジェクトをビルドできる。
- プロジェクトのビルドと実行を`cargo run`で1ステップでできる。
- ビルドの結果をコードと同じディレクトリに保存するのではなく、Cargoは`target/debug`ディレクトリに格納する。
- 最適化をかける際は`cargo build --release`でビルドし、`target/release`の実行可能ファイルを使用する。

## <参考元>

- [Rust本家](https://www.rust-lang.org/)
- [Rustの日本語ドキュメント](https://doc.rust-jp.rs/)
- [プログラミング言語 Rust, 2nd Edition](https://doc.rust-jp.rs/book/second-edition/)
