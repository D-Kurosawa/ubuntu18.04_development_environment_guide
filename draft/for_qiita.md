# Ubuntuの開発マシン構築ガイド

## はじめに

**Windows環境で開発を行うものではない**という記事を良く目にします。実際そうなのでしょうか？いろいろな言語もインストールできるし問題なのではと思い、会社のWindows環境で開発を行ってきました。ソースコード管理でgitを使うことになりMSYS2を導入しました。そこで感じたのです。

あ、Windowsっていろいろと面倒！

確かにVisual Studioは便利だと思います。重いけど。。。でもVisual Studioに同梱されていない言語を使うときは大変でした。環境構築でコケたりするとエラーの原因を探るのが大変。Qiitaを見てもMacやLinuxの対処方法は載っているけどWindowsはない。これ地獄です。時間を無駄にします。

MSYS2からWSLを利用するようになりいろいろと楽になりましたが、**Linuxをそのまま使う方がもっと楽なんじゃ？**と感じるようになり、Ubuntuの開発マシンを構築することにしました。

## 1. Ubuntuをインストールするマシン

初心者が実機にいきなりUbuntuをインストールするのは危険と判断し**Virtual Box**でまずはためします。

仮想環境でうまくいったことをここに記録し実機のインストールに活用しようと考えています。

### 1-1. Virtual Boxって

Virtual Boxとは、仮想環境を構築するためのもので、1台のマシンで複数のOSを立てることができます。

仮想環境を構築するメリットとしては、以下のような項目などがあります。

- 複数人で開発するときに開発環境を揃えることができる
- プロジェクト毎に立てたり破棄することによってローカルのマシンが汚れない
- 導入・破棄が簡単にできる

### 1-2. Virtual Boxのインストール

Virtual Boxは[公式サイト](https://www.virtualbox.org/)からダウンロードできます。2019年10月4日時点での最新版は`VirtualBox 6.0.12`です。OS毎にダウンロードするファイルが違うので注意してください。

| OS | Download file |
| ------- | ------------- |
| Windows | Windows hosts |
| Mac     | OS X hosts |
| Linux   | Linux distributions |

OSにあったファイルをダウンロードしたらインストーラに従ってインストールします。基本的にデフォルトのインストールでOKです。

### 1-3. Virtual Boxの環境設定

Virtual Boxで新規 ---> OSを選択してガイドに従って構築すると最低限の仮想環境が構築できます。

メモリサイズやディスク容量はホスト側のスペックと相談して増量してください。また仮想環境は動作が重いのでSSDでの構築がおすすめです。一方でスナップショットを撮りまくると容量を圧迫するので構築ディレクトリ、ディスク容量も吟味する必要がありますが、再構築が簡単にできるのでそこまで気にすることはありません。

## 2. Ubuntuのインストール

### 2-1. ISOイメージを準備する

2019年10月4日現在でUbuntu LTSの最新バージョンは`18.04.3`でなので、`Ubuntu 18.04.3 LTS`（本家版）、もしくは`Ubuntu 18.04.3 LTS 日本語 Remix`のISOイメージをダウンロードします。

今回は`Ubuntu 18.04.3 LTS 日本語 Remix`を使用してUbuntuを仮想マシンにインストールします。

#### LTSって

LTSとは、**Long Term Support**の略でサポート期間が普通のものより長いことを意味してます。

普通のUbuntuはサポート期間が最低9か月なのに対して、LTS版は最低5年のサポートが保証されます。

このサポートとは、不具合に対してのアップデートと言えるでしょう。悪意のある攻撃で脆弱性が発見されたり、多くのユーザが利用することで開発、テスト段階では見つけられなかった不具合が発見される、ということが多々あります。初期段階でその全てを完璧に作成することは不可能ですし、時代や技術の進歩につれて改善を強いられることは日常茶飯事です。

なので、事あればアップデートということは現段階では欠かすことのできない作業です。そのアップデートが5年保証されているということです。よってLTS版を使うのがスタンダードです。

| バージョン | リリース日 | 最新版 | サポート期間 |
| --------- | ---------- | ------- | ------- |
| 18.04 LTS | 2018-04-26 | 18.04.3 | 2023-04 |
| 18.10     | 2018-10-18 | -       | 2019-07 |
| 19.04     | 2019-04-18 | -       | 2020-01 |

#### 日本語 Remixって

日本語 Remixとは、[Japan Team](https://www.ubuntulinux.jp)がUbuntuに日本語環境を追加したリビジョンのことです。

Ubuntuにはデフォルトで日本語が入っていないため、自分で日本語環境を追加インストールする必要があります。特にインストール時には日本語環境がないため英語でインストールすることになります。その点、日本語 Remixではインストール時から日本語環境を利用することができます。

本家と日本語 Remixの内容に大きな差異はありません。ただし、更新は `本家  --> 日本語 Remix` の順となるため最新版を利用したい場合は本家からダウンロードする必要があります。一方で、日本語環境関連のバグ修正に関しては日本語 Remixの方が更新が早いことがあります。

### 2-2. インストール

Virtual Boxの指示に従ってISOイメージをマウントしてインストールします。

その後はガイドに従ってイントールします。以下はガイドの選択順です。

1. 言語選択で`日本語`を選択してから`Ubuntuをインストール`をクリック
2. キーボードを選択して`続ける`をクリック
3. `通常のインストール`と`Ubuntuのインストール中にアップデートをダウンロードする`にチェックを入れて`続ける`をクリック
4. `ディスクを削除してUbuntuをイントール`にチェックを入れて`インストール`をクリック
5. `続ける`をクリック
6. 地域を選択して（Tokyo）、`続ける`をクリック
7. 名前、ユーザー名、パスワード等を入力してから`続ける`をクリック
8. イントール開始
9. `今すぐ再起動する`をクリック
10. ログイン前に画面が止まるので`Enter`を入力
11. ログイン後、ソフトウエアの更新が表示されていたら`今すぐインストールする`をクリックしてパスワード認証に従う
12. アップデート内容によっては指示に従い再起動する

### 2-3. インストール直後にとりあえずやること

#### とりあえず環境を最新にする

`Ctrl + Alt + T`でターミナルを起動して、以下のコマンドを実行して環境を最新にします。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します
# -yは Yes/No 表示を表示しないで Yes として進めるオプションなので付けても付けなくても良い

sudo apt update
sudo apt -y upgrade
```

#### ディレクトリを英語表記に変更する

ディレクトリが日本語だとCUIで何か行う際にいろいろと面倒なので、以下のコマンドを実行してhomeディレクトリの中を英語表記に変更します。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

LANG=C xdg-user-dirs-gtk-update
```

実行するとダイアログが出て英語にリネームできます。**Don't ask me this again**をチェックしてこのダイアログを閉じると、`xdg-user-dirs-gtk-update`を実行しても何も起こらなくなってしまいますが、対処方法があるのでチェックして閉じましょう。

`xdg-user-dirs-gtk-update`を実行しても何も起こらない場合は`$ echo 1234 .config/user-dir.locale`としたあと`xdg-user-dirs-gtk-update`すればよい。（"1234"は適当な文字列でOK）

##### <参考元>

- [Ubuntuでホームディレクトリの中身を英語にする](https://qiita.com/taiko19xx/items/d1a001bfc25245b91354)
- [「デスクトップ」等のディレクトリ名を英語にする](https://qiita.com/take5249/items/13ada73bbd01ee12a2c3)

## 3. ブラウザのインストール

### 3-1. Google Chromeのインストール(deb版)

Ubuntuには`Fire Fox`がデフォルトでインストールされてますが、私は`Google Chrome`を普段から利用しているので、使い勝手という観点から`Google Chrome`をインストールします。

最も簡単な方法はGUIから`Fire Fox`を起動してChromeを検索してイントールする方法です。リポジトリも登録されるのでアップデートもできます。

### 3-2. Google Chromeのインストール(apt版)

apt リポジトリとしてGoogle Chromeを追加するには、以下のコマンドを実行します。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

# apt リポジトリ
wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'

sudo apt update

# インストール
sudo apt install google-chrome-stable
```

## 4. エディタのインストール

### 4-1. Visual Stadio Code のインストール

Ubuntuのエディタといったら「VimかEmacsでしょ」と言われそうですが。。。Vimは軽量だし使うのかっこよさげ。だけどここでは普段から使っている`Visual Stadio Code`をインストールします。Vimは追って。。。

1. `Chrome`で`vs code`と検索し[公式サイト](https://code.visualstudio.com/)にいく
2. `Download`をクリックする
3. `Linux`の下の方にある`Snap Store`を選択
4. `Install`をクリック
5. `Install using the command line`に記載されているコマンドをターミナルに入力
6. ターミナルに`code`と入力して`Visual Stadio Code`が立ち上げればOK

簡単ですね。これからは`Snap`を用いたアプリ導入が主流になるみたいなので使ってみました。

### 4-3. nano のインストール

ターミナルから直接処理できるエディタは便利なので、コンソールなエディタのなかで「最も優しい」エディタといわれる`nano`をインストールします。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

sudo apt install nano
```

ターミナルに`nano`と入力し`nano`が立ち上げればOK。`Ctrl + x`を入力し`nano`を終了します。

### 4-3. vim のインストール

Linuxの標準的なエディタなので使う使わないは別として`vim`もインストールしておきます。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

sudo apt install vim
```

ターミナルに`vim`と入力し`vim`が立ち上げればOK。`:q`を入力し`vim`を終了します。

なお、ターミナルに`vimtutor`と入力すると`vim`のチュートリアルが立ち上がるので、1度やってみることをおすすめします。

## 5. 開発環境構築

### 5-1. ビルドツールのインストール

ビルドツールである`build-essential`をインストールするには、以下のコマンドを実行します。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

sudo apt install build-essential

# 不要なパッケージが検出された場合は以下のコマンドを実行
sudo apt autoremove
```

#### 5-1-1. 確認

gcc, g++, makeが正しくインストールされているか否かはバージョンを表示して確認します。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

gcc --version
g++ --version
make --version
```

上記の3つは、他のアプリをビルドして使用する際に良く使用するので必ず入れておきましょう。

#### 5-1-2. サンプルプログラムのコンパイル＆実行

適当なディレクトリに以下の2つのソースコードを記載する。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

cd
mkdir test_compile
cd test_compile/
nano hello.c
nano hello.cpp
```

```c
// [hello.c]
#include <stdio.h>

int main(void)
{
    printf("Hello World!\n");

    return 0;
}
```

```c++
// [hello.cpp]
#include <iostream>

int main()
{
    std::cout << "Hello World!\n" << std::endl;

    return 0;
}
```

それぞれのソースを以下のコマンドでコンパイルして実行します。ターミナルに`Hello World!`と表示されれば成功です。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

gcc -o hello1 hello.c
g++ -o hello2 hello.cpp

./hello1
./hello2
```

### 5-2. Git のインストール

Gitは開発だけではなくパッケージのインストール等いろいろな場面でしようするので、以下のコマンドを実行してインストールします。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

sudo apt install git

# Gitの設定も一緒にやってしまいましょう
git config --global user.name "hoge hogehoge"
git config --global user.email "hogehoge@email.com"
git config --global color.ui "auto"

# 設定の確認
git config --global --list
```

Gitの設定情報は以下のファイルに保存されるのでエディタでの直接編集も可能です。
**`~/.gitconfig`**

### 5-3. Fortran のインストール

何かとFortranを使用する機会があるので、Fortran環境を構築します。

#### 5-3-1. gfortran のインストール

Fortranのコンパイラである`gfortran`をインストールするには、以下のコマンドを実行します。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

sudo apt install gfortran
```

`gfortran`が正しくインストールされているか否かはバージョンを表示して確認します。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

gfortran --version
```

##### 5-3-2. サンプルプログラムのコンパイル＆実行

適当なディレクトリに以下のソースコードを記載する。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

cd
mkdir test_compile
cd test_compile/
nano hello.f90
```

```fortran
! [hello.f90]
program hello
    implicit none

    print *, "Hello, World!"
end program hello
```

ソースを以下のコマンドでコンパイルして実行します。ターミナルに`Hello World!`と表示されれば成功です。

```bash
# コピペを簡単に行うために、ターミナルの「$」は省略します

gfortran hello.f90 -o hello

./hello
```

### 5-4. Python3 のインストール

Ubuntuを含むほとんどのLinux ディストリビューション（FreeBSD、NetBSD、OpenBSD、macOS）では、Pythonはデフォルトでインストールされるか、システムのパッケージリポジトリにPythonを収録しています。これらの環境の多くは、Pythonをコアコンポーネントの一部として利用しています。UbuntuのインストーラーのUbiquityなどはPython上で動作します。

このため、システムのパッケージ管理ツール（aptなど）が管理するシステムのネイティブパッケージとして、PyPI由来の数多くのパッケージをインストールできます。しかし、入手できるライブラリの数はPyPIよりも少なく、またほとんどのライブラリのバージョンが古い点に注意が必要です。PyPA（Pythonパッケージオーソリティ）が推奨しているとおり、最新のパッケージの取得にはpipコマンドを使うべきです。

#### 5-3-1. 環境分離の必要性

pipは、システム全体で使われるパッケージのインストールに使われることが多いでしょう。UnixベースのシステムやLinuxのシステムであれば、スーパーユーザー権限が必要になるため、実際には以下の形式で実行されます。

```bash
sudo pip install <パッケージ名>
```

システム全体から使われるパッケージをPyPIから直接インストールすることはお勧めできませんし、避けるべきです。これは先に説明したように、Pythonはオペレーティングシステムのパッケージリポジトリ経由でインストールされる多くのパッケージの一部として使われる場合が非常に多く、重要なシステムを駆動するのにも使われているからです。システムディストリビューションのメンテナーは、さまざまなパッケージの依存関係が壊れないように、パッケージのバージョンの選択に非常に多くの時間を費やしています。そのために、システムのリポジトリで提供されるPythonのパッケージは、システム固有のパッチが当たっていたり、他のコンポーネントとの依存関係を維持するために、古いバージョンに固定されていることがあります。これらのパッケージをpipを使って強制的に最新バージョンに更新してしまうと、後方互換性が崩れたり、システムの重要なサービスが動作しなくなることがあります。

開発目的だとしても、ローカルコンピュータ上でこのようなことをやって良いことにはなりません。pipを強引に使用すると、デバッグが非常に難しいトラブルに遭遇する確率が上がります。pipを使ってシステムグローバルにパッケージをインストールすることを禁止はしませんが、リスクを認識しながら行うべきことであると意識してください。

この問題は、環境を分離することで簡単に解決できます。環境分離のためのツールは数種類あり、それぞれ異なるレベルでシステムを抽象化し、Pythonランタイム環境を分離します。もっともよく利用されるのが、システム、サービス、プロジェクト、それぞれに必要なパッケージや依存関係を分離するツールです。この方法には次のようなメリットがあります。

- プロジェクトXはライブラリZのバージョン1.xに依存するが、プロジェクトYはライブラリZの4.x を必要とする、というジレンマを解消します。依存ライブラリが衝突してお互いに影響を与えるようなリスクを避けながら、開発者が複数のプロジェクトを同時に扱えるようになります。
- 開発者が、使用しているシステムのディストリビューションリポジトリで提供されているパッケージのバージョンに拘束されることなく、プロジェクト側で任意に決定できるようになります。
- 開発環境にのみ導入された新しいパッケージのバージョンにより、特定のパッケージバージョンに依存するシステムサービスに影響を与えることがなくなります。
- プロジェクトに依存関係のあるパッケージ一覧を簡単に「凍結」できます。新しいシステム上で
同じ環境を再現することが簡単に行えます。

環境を分離する方法のうち、もっとも簡単で軽量な方法が、アプリケーションレベルの仮想環境を使用することです。この方法は、Pythonインタープリタとそれが使用可能なパッケージを分離することだけを行います。セットアップは簡単で、小さいプロジェクトやパッケージの開発には十分です。

#### 5-3-x. pyenv

#### 5-3-1. pipenv

#### 前のやつ

`sudo apt install python3.7`でもインストールできるようだが、[Python Japan 公式](https://www.python.jp/install/ubuntu/index.html)のイントール方法は以下の通りである。

>
> ## Ubuntu環境のPython
>
> Ubuntu には最初からPythonがインストールされており、そのまま利用可能です。
> しかし、このPython は OS がさまざまな機能を提供するために使用しています。ユーザが勝手にパッケージを導入したりすると、 OS の安定性を損なうことも考えられます。また、バージョンが古く、Pythonの最新機能は使用できません。
> そこで、ここでは最新版のPythonをダウンロードし、インストールする手順を紹介します。
>
> ### Pythonのビルド
>
> #### 1. ビルドツール・ライブラリのインストール
>
> 次のコマンドで、必要なツール類をダウンロードします。
>
> ```bash
> # コピペを簡単に行うために、ターミナルの「$」は省略します
>
> sudo apt update
> sudo apt install build-essential libbz2-dev libdb-dev libreadline-dev \
>   libffi-dev libgdbm-dev liblzma-dev libncursesw5-dev libsqlite3-dev \
>   libssl-dev zlib1g-dev uuid-dev tk-dev
> ```
>
> #### 2. ソースコードのダウンロード
>
> [Python公式](https://www.python.org/downloads) よりパッケージをダウンロードします。
> 利用するPythonのバージョンを選択します。特別な理由がなければ、最新版のPythonをクリックします。画面の一番下にダウンロード可能なファイルが表示されますので、「**Gzipped source tarball**」をダウンロードします。
> ダウンロードしたファイルは、次のコマンドで解凍します。
>
> ```bash
> # コピペを簡単に行うために、ターミナルの「$」は省略します
> # Python3.7.4をダウンロードしたと想定
>
> cd ~/Downloads/
> tar xzf Python-3.7.4.tgz
>```
>
> #### 3. ビルド
>
> 次のコマンドで、Pythonをビルドしてインストールします。
>
> ```bash
> # コピペを簡単に行うために、ターミナルの「$」は省略します
> # Python3.7.4をダウンロードしたと想定
>
> cd Python-3.7.4
> ./configure --enable-shared
> make
> sudo make install
> sudo sh -c "echo '/usr/local/lib' > /etc/ld.so.conf.d/custom_python3.conf"
> sudo ldconfig
> ```
>
> ビルドしたコマンドは **/usr/local/bin** にインストールされ、**python3.7** コマンドまたは **python3** コマンドで起動できます。

### 5-x. Go のインストール

### 5-x. Rust のインストール

### 5-x. Clang のインストール

### 5-x. Node.js のインストール

### 5-x. Vue.js のインストール

### 5-x. Java のインストール

### 5-x. Kotlin のインストール

### 5-x. Ruby のインストール

### 5-x. JetBrains IDE のインストール

## MEMO

[Ubuntu 18.04 LTSインストールガイド【スクリーンショットつき解説】](https://linuxfan.info/ubuntu-18-04-install-guide)

[Ubuntu 18.04 LTSのインストール直後にやっておきたいことまとめ](https://linuxfan.info/ubuntu-18-04-basic-settings)

[ubuntu導入後にしたことメモ](https://crowrabbit.hatenablog.com/entry/2019/05/18/ubuntu%E5%B0%8E%E5%85%A5%E5%BE%8C%E3%81%AB%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8%E3%83%A1%E3%83%A2)

[Ubuntuをインストールしたらまずやることリスト](https://www.iandprogram.net/entry/2015/09/11/181208)

[Ubuntu 18.04 LTSをインストールした直後に行う設定 & インストールするソフト](https://sicklylife.jp/ubuntu/1804/settings.html)

[Ubuntu 18.04 LTSインストール後にすべきこと](https://news.mynavi.jp/article/20180501-ubuntu_install/)

[Ubuntu 18.04と18.10をインストールした後の作業](https://ja.enterpriseunix.org/things-do-after-installing-ubuntu-18)

[WindowsにUbuntuをインストールするのは気持ち良いゾイ!!~導入編~](https://qiita.com/Takumi_Kaibara/items/4132e552a615a050a841)

[Ubuntuでやっていく_001_初期設定の参考とUIをかっこよくするところまで](http://paperface.hatenablog.com/entry/2018/06/27/Ubuntu%E3%81%A7%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%81%8F_001_%E5%88%9D%E6%9C%9F%E8%A8%AD%E5%AE%9A%E3%81%AE%E5%8F%82%E8%80%83%E3%81%A8UI%E3%82%92%E3%81%8B%E3%81%A3%E3%81%93%E3%82%88%E3%81%8F)

- [参考リンク1](https://qiita.com/take5249/items/13ada73bbd01ee12a2c3)
- [参考リンク2](https://www7390uo.sakura.ne.jp/wordpress/archives/tag/xdg-user-dirs-gtk-update)
- [参考リンク3](https://crowrabbit.hatenablog.com/entry/2019/05/18/ubuntu%E5%B0%8E%E5%85%A5%E5%BE%8C%E3%81%AB%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8%E3%83%A1%E3%83%A2)
- [参考リンク4](https://qiita.com/taiko19xx/items/d1a001bfc25245b91354)
